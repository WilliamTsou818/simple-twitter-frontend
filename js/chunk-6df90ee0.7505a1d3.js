(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6df90ee0"],{"068f":function(t,e,s){},"7db0":function(t,e,s){"use strict";var o=s("23e7"),r=s("b727").find,a=s("44d2"),n="find",i=!0;n in[]&&Array(1)[n]((function(){i=!1})),o({target:"Array",proto:!0,forced:i},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),a(n)},caa1:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container container--chat"},[s("transition",{staticClass:"modal",attrs:{name:"modal"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isListOpen,expression:"isListOpen"}],staticClass:"chat__modal lg-d-none",on:{click:t.handleToggleList}},[s("div",{staticClass:"chat__modal__container"},t._l(t.privateRooms,(function(t){return s("ChatList",{key:t.RoomId,attrs:{user:t.User,room:t}})})),1)])]),s("div",{staticClass:"chat"},[s("div",{staticClass:"chat__lists md-d-none"},[s("Head",{attrs:{title:"訊息",message:""}}),t._l(t.privateRooms,(function(t){return s("ChatList",{key:t.RoomId,attrs:{user:t.User,room:t}})}))],2),s("div",{staticClass:"chat__room"},[s("Head",{attrs:{title:t.currentRoomData.User?t.currentRoomData.User.name:"",account:t.currentRoomData.User?t.currentRoomData.User.account:""}}),s("div",{staticClass:"chat__room__icon lg-d-none",on:{click:t.handleToggleList}},[s("IconList")],1),s("ChatRoom",{attrs:{chats:t.privateAllMessages},on:{"new-chat":t.handleNewChatSend}})],1)])],1)},r=[],a=s("1da1"),n=s("5530"),i=(s("96cf"),s("a9e3"),s("7db0"),s("4cce")),c=s("2708"),l=s("2f62"),u=s("7a0f"),m=s("5527"),d=s("0b0f"),h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M19.75 22H4.25C3.01 22 2 20.99 2 19.75V4.25C2 3.01 3.01 2 4.25 2H19.75C20.99 2 22 3.01 22 4.25V19.75C22 20.99 20.99 22 19.75 22ZM4.25 3.5C3.836 3.5 3.5 3.837 3.5 4.25V19.75C3.5 20.163 3.836 20.5 4.25 20.5H19.75C20.164 20.5 20.5 20.163 20.5 19.75V4.25C20.5 3.837 20.164 3.5 19.75 3.5H4.25Z",fill:"black"}}),s("path",{attrs:{d:"M17 8.64002H7C6.586 8.64002 6.25 8.30301 6.25 7.89001C6.25 7.47701 6.586 7.14001 7 7.14001H17C17.414 7.14001 17.75 7.47501 17.75 7.89001C17.75 8.30501 17.414 8.64002 17 8.64002ZM17 12.75H7C6.586 12.75 6.25 12.414 6.25 12C6.25 11.586 6.586 11.25 7 11.25H17C17.414 11.25 17.75 11.586 17.75 12C17.75 12.414 17.414 12.75 17 12.75ZM12 16.86H7C6.586 16.86 6.25 16.525 6.25 16.11C6.25 15.695 6.586 15.36 7 15.36H12C12.414 15.36 12.75 15.697 12.75 16.11C12.75 16.523 12.414 16.86 12 16.86Z",fill:"black"}})])},p=[],v=s("2877"),f={},g=Object(v["a"])(f,h,p,!1,null,null,null),R=g.exports,C={name:"PrivateRoom",mixins:[c["a"]],components:{Head:u["a"],ChatList:m["a"],ChatRoom:d["a"],IconList:R},data:function(){return{isLoading:!0,isJoin:!1,currentRoomData:{},isListOpen:!1}},computed:Object(n["a"])({},Object(l["b"])(["currentUser","privateRooms","privateAllMessages"])),created:function(){if(this.$socket.connected){var t=this.$route.params.room_id;this.openPrivateRoom(Number(t))}},beforeRouteUpdate:function(t,e,s){this.isJoin&&(this.$socket.emit("leavePrivateRoom"),this.handleToggleList());var o=t.params.room_id;this.openPrivateRoom(Number(o)),s()},beforeDestroy:function(){this.isJoin&&this.$socket.emit("leavePrivateRoom")},sockets:{connect:function(){var t=this.$route.params.room_id;this.openPrivateRoom(Number(t))},error:function(t){console.log("privateRoon socket error",t);var e="";switch(t.errType){default:e="PrivateRoom Error!";break}this.ToastError({title:e,description:t.message})},newPrivateRoom:function(){this.fetchAllRooms()},unReadMessage:function(){this.fetchAllRooms()}},methods:{openPrivateRoom:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,e.fetchAllRooms();case 2:e.joinPrivateRoom(t);case 3:case"end":return s.stop()}}),s)})))()},fetchAllRooms:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var s,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoading=!0,e.next=4,i["a"].messages.getPrivateRoom();case 4:s=e.sent,o=s.data,t.$store.dispatch("setPrivateRooms",o),t.isLoading=!1,e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](0),r="",e.t0.response?(console.log(e.t0.response.data),r=e.t0.response.data.message):(console.log(e.t0),r=e.t0.message),t.ToastError({title:"獲取訊息失敗！",description:r});case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))()},joinPrivateRoom:function(t){var e=t?this.privateRooms.find((function(e){return e.RoomId===t})):null;!e&&this.privateRooms.length>0?this.$router.push({name:"PrivateRoom",params:{room_id:this.privateRooms[0].RoomId}}):e&&(this.currentRoomData=Object(n["a"])({},e),this.$socket.emit("joinPrivateRoom",{targetUserId:e.UserId,currentUserId:this.currentUser.id},(function(t){})),this.isJoin=!0,this.fetchAllMessages(t))},fetchAllMessages:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function s(){var o,r,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isLoading=!0,s.next=4,i["a"].messages.getPrivateAll({RoomId:t});case 4:o=s.sent,r=o.data,e.$store.dispatch("setPrivateAllMessages",r),e.isLoading=!1,s.next=15;break;case 10:s.prev=10,s.t0=s["catch"](0),a="",s.t0.response?(console.log(s.t0.response.data),a=s.t0.response.data.message):(console.log(s.t0),a=s.t0.message),e.ToastError({title:"獲取私訊失敗！",description:a});case 15:case"end":return s.stop()}}),s,null,[[0,10]])})))()},handleNewChatSend:function(t){this.$socket.emit("privateMessage",{currentUserId:this.currentUser.id,RoomId:this.currentRoomData.RoomId,targetUserId:this.currentRoomData.UserId,content:t})},handleToggleList:function(){this.isListOpen=!this.isListOpen}}},w=C,b=(s("d386"),Object(v["a"])(w,o,r,!1,null,"b14c13f2",null));e["default"]=b.exports},d386:function(t,e,s){"use strict";s("068f")}}]);
//# sourceMappingURL=chunk-6df90ee0.7505a1d3.js.map